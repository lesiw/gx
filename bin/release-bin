#!/bin/sh

set -e

while IFS=':' read -r GOOS GOARCH UNAMES UNAMER
do
    echo "Building $GOOS/$GOARCH"
    export GOOS GOARCH
    go build -ldflags="-s -w" -o "build/pb-$UNAMES-$UNAMER" .
    if [ ! -f "build/pb-$GOOS-$GOARCH" ] || [ -L "build/pb-$GOOS-$GOARCH" ]
    then
        rm -f "build/pb-$GOOS-$GOARCH"
        ln -s "pb-$UNAMES-$UNAMER" "build/pb-$GOOS-$GOARCH"
    fi
done < etc/platforms
