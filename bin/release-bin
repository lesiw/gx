#!/bin/sh

set -e

while IFS=':' read -r GOOS GOARCH UNAMES UNAMER
do
    echo "Building $GOOS/$GOARCH"
    export GOOS GOARCH
    go build -ldflags="-s -w" -o "build/gx-$UNAMES-$UNAMER" .
    if [ ! -f "build/gx-$GOOS-$GOARCH" ] || [ -L "build/gx-$GOOS-$GOARCH" ]
    then
        rm -f "build/gx-$GOOS-$GOARCH"
        ln -s "gx-$UNAMES-$UNAMER" "build/gx-$GOOS-$GOARCH"
    fi
done < etc/platforms
